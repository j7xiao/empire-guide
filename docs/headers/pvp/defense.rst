The Art of the ... Defense?
===========================

.. |castle-wall| image:: ./images/castle-wall.png
    :scale: 50 %

We already introduced the defense under `wall basics <introduction.html>`_. Give it a read if you haven't already. No, go ahead. I'll wait. (:

:blue:`The Castle Wall -- Revisted`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|castle-wall|

The left flank says :olive:`98%`, the front :olive:`1%`, and the right flank :olive:`1%`. This is called your wall ratio. The above wall ratio would be designated as ":olive:`98-1-1`" in shorthand. You can adjust it by sliding the wooden knobs around. The :olive:`6,793` on the right tab indicates how many troops the wall can hold ("wall unit capacity"). The :olive:`0/6,793` means that there are 0 troops in the castle.

This is actually an important topic that is worth sidetracking a moment for.

.. important::
    Troops are an extremely valuable asset. Until very late game, they are extremely succeptible to enemy attacks. There will always be a bigger fish, meaning your troops are never safe. While you are away from the game, it is important to safehouse your troops, by stationing them at an alliance mate who is under protection mode. Protection mode prevents another player from attacking them, but in exchange, they can't hit other players. All larger alliances will have a "bird" to send troops to when you're away from the game - Even if it is a shell account whose only purpose is to safehouse troops. That's how important it is. You'll even see top players bird their troops!

Anyways, back to the wall ratio. Why are almost all of the troops grouped on one flank? This is due to how the castle wall battle functions. The attackers has :olive:`3` flanks to attack from, just like the defender has :olive:`3` flanks to defend from.

:blue:`Basic Battle Mechanics`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There are two parts of the attack: the wall battle and the courtyard assault. Most attack troops are typically in the wall battle, but there will be trailing troops called the "courtyard assault". If the attacker manages to break at least one flank, all surviving troops in addition to the courtyard assult will fight in the ensuing courtyard battle. The courtyard assault will be returned to the attacker if all :olive:`3` flanks are successfully defended.

If the defender is significantly stronger then the attacker, he typically wants to kill all the trailing troops by intentionally leaving a flank "open" (assigning 0% of the wall trops to a flank) and destroying all of them in the ensuing courtyard assault. The defender will naturally lose more troops then if he simply defended all three flanks, but sometimes it's about sending a message.

If the defender sucessfully defends :olive:`2` flanks, he gains a :olive:`30%` courtyard strength bonus. If the defender only defends :olive:`1` flank, the courtyard battle "goes even", and neither side receives a bonus. If the defender cannot defend any flank, then the attackers gains a :olive:`30%` courtyard strength bonus.

Typically, a player can comfortably defend one flank. There are some situations, where the defender may elect to defend two flanks (:olive:`35-65-0` or :olive:`50-0-50` typically). There is an inherent risk. If he sucessfully defends two flanks, he gets the :olive:`30%` courtyard bonus. But usually if he can't, he loses both flanks and the attackers gains :olive:`30%` courtyard bonus. That is a massive swing in power, and can make or break an attack.

:blue:`The Melee/Ranged ratio`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. |m-r-ratio| image:: ./images/m-r-ratio.png
    :scale: 50 %

Let's borrow this image yet again:
|castle-wall|

The quiver and sword image on each flank determines the melee/range ratio of the wall segment. Click on it to reveal the ratio of troops on that wall section. This is called the m/r ratio. A lot of experienced players will write it in shorthand. The below image for example is :olive:`80%` melee and :olive:`20%` ranged or ":olive:`80m/20`" in shorthand.
|br| |m-r-ratio|

Assuming there is enough troops to fill the wall up with the correct ratio, the game will first partition the wall up (in this case, :olive:`98-1-1`). Then the game will populate the wall up to the wall unit capacity according to the m/r ratio of each section. All other troops in the castle will be kept in the courtyard pending a potential courtyard battle.

:blue:`Why 80m/20?`
~~~~~~~~~~~~~~~~~~~

If you're reading on from the `previous section <tools-waves.html>`_, this is the part you have been waiting so patiently for. Here we'll explain what influences the m/r ratio. This will ultimately determines how you'll setup your attack.

Remember how I explained there were two types of waves, the "shield wave" and the "alt wave"? Its necessity is based off optimal defense setups. Let's explore how the attacker can overcome common defense setup blunders.

:underline:`1. 100r/0 ~ A Lesson in Wall Wiping`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Remember how the melee and ranged bonus starts with :olive:`100%` power? If the attacker reduces the ranged bonus below :olive:`100%` with shield walls, the ranged defenders effectively operate at partial power. But what if the attacker reduces the ranged power to :olive:`0%`?

This is what wall wiping is. It doesn't matter if there are 200 or 200 million ranged troops on the wall. If the ranged power is reduced to :olive:`0%`, functionally speaking, their collective power is :olive:`0`. This makes sense as their power is being multiplied by :olive:`0.` This means if the attacker sends at least 1 troop, that 1 troop will kill the entire wall section, hence "wiping" (again, assuming it's all ranged). 

The absolute maximum ranged bonus on the wall is :olive:`100%` (base) + :olive:`250%` (:olive:`5` slits) + :olive:`300%` (maximum castellan) = :olive:`650%`. If you sent :olive:`44` shield walls, that will bring the defenders ranged bonus to :olive:`-660%`. Although on that note, the ranged bonus cannot be reduced below :olive:`0%`. There are no mechanics for "healing" your own troops in battle.

.. danger::
    Do not set your wall ratio to all ranged! 100r/0 would bring even the strongest player down to their knees.

:underline:`2. 100m/0`
^^^^^^^^^^^^^^^^^^^^^^

Thankfully, the attacker cannot reduce the melee defender's power, so you can avoid the wall wiping fiasco. However, :olive:`100m/0` is still a blunder. The attacker sends all ranged. The attacker gets type advantage for free. The attacker does not need to send shield waves, which means all his waves are sent at :olive:`100%` strength as there are no tools being "`left out <tools-basics.html#three-defensive-bonuses-two-tool-slots-help>`_".

:underline:`3. Ranged Majority`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Remember that the defending ranged troop's power can be reduced by attacking tools. That is why it is a mistake to set your ratio to ranged majority. If you set to :olive:`70r/30` for example, the attacker can compose his attack of majority shield waves, and nullify :olive:`70%` of your troop power!

:blue:`Melee Majority Ratio`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

So what we have left is melee majority ratio. So Why :olive:`80m/20`? The answer is that it provides enough unreduceable melee power while also providing ranged power to interfere with any attacking ranged troops, as again, :olive:`100m/0` is a blunder. Some people will argue for :olive:`70m/30`. This is valid argument as well, but depends on how many shield waves the attacker sends. We must swap back to the attacking aspect to complete our journey through the Art of the Attack.

You're almost done! ヾ（〃＾∇＾）ﾉ♪
